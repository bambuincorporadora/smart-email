version: "3.9"

services:
  server:
    build:
      context: ./server
      dockerfile: Dockerfile
    env_file:
      - ./.env
    environment:
      - PORT=${SERVER_PORT:-4000}
      - OPENAI_API_KEY=${OPENAI_API_KEY:-}
      - OPENAI_MODEL=${OPENAI_MODEL:-gpt-4o-mini}
      - NODE_ENV=production
    expose:
      - "4000"

  web:
    build:
      context: ./web
      dockerfile: Dockerfile
      args:
        - VITE_AAD_CLIENT_ID=${VITE_AAD_CLIENT_ID}
        - VITE_AAD_TENANT_ID=${VITE_AAD_TENANT_ID:-common}
        - VITE_AAD_REDIRECT_URI=${VITE_AAD_REDIRECT_URI:-http://localhost:5173}
        - VITE_API_BASE=${VITE_API_BASE:-http://localhost:4000}
        - VITE_SUPABASE_URL=${VITE_SUPABASE_URL}
        - VITE_SUPABASE_ANON_KEY=${VITE_SUPABASE_ANON_KEY}
    expose:
      - "80"
    depends_on:
      - server
